import Mathlib.Tactic


theorem cav20_4_1 (x₁ x₂ x₃ x₄: ℝ)
             (h₁ : f₁=16-16*(x₁+x₂)^2-(x₁-x₂+4)^2-x₃^2)
             (h₂ : f₂=x₂-x₁-x₄^2-(1-x₄)^2)
             (h₃ : I=(3*x₁)/100 + (2*x₂)/25 - (103*x₁*x₂)/50 - (3*x₁^2)/100 - x₂^2/50 + 91/100):
              0 ≤ f₁ ∧ 0 ≤ f₂
                →  I > 0 := by
  let p₀: ℝ :=(31*x₁)/100 - (51*x₂)/200 - (21*x₄)/200 + (7*x₁*x₂)/100 + (3*x₁*x₄)/400 - (3*x₂*x₄)/400 + (3*x₁^2)/25 + (19*x₂^2)/150 - x₃^2/20 - (7*x₄^2)/150 + 10099/10000
  let p₁: ℝ :=(903701*x₁)/1009900 - (54883*x₂)/201980 - (81879*x₄)/4039600 + (913001*x₁*x₂)/4039600 - (120389*x₁*x₄)/4039600 - (92453*x₂*x₄)/1514850 + (116407*x₁^2)/403960 + (2164639*x₂^2)/12118800 + (274079*x₃^2)/4039600 + (233779*x₄^2)/1514850
  let p₂: ℝ :=(113834873*x₂)/135555150 + (3584553*x₄)/180740200 - (15019029*x₁*x₂)/90370100 - (76441421*x₁*x₄)/1084441200 - (51973223*x₂*x₄)/1084441200 - (6846207*x₁^2)/72296080 - (10357627*x₂^2)/43377648 - (1118838*x₃^2)/22592525 - (6231283*x₄^2)/54222060
  let p₃: ℝ :=(48246560893*x₄)/109281478080 - (80327886401*x₁*x₂)/546407390400 + (744657281*x₁*x₄)/9106789840 - (12937166221*x₂*x₄)/182135796800 - (10246934177*x₁^2)/182135796800 - (1244108681*x₂^2)/22766974600 - (107054541*x₃^2)/10713870400 - (6768269647*x₄^2)/45533949200
  let p₄: ℝ :=(160728542688691*x₁*x₂)/385972487144000 + (14848715109037*x₁*x₄)/154388994857600 + (100944858422603*x₂*x₄)/2315834922864000 + (297272985601867*x₁^2)/771944974288000 + (100829971516789*x₂^2)/2315834922864000 - (1067434229029*x₃^2)/385972487144000 + (31233159300551*x₄^2)/578958730716000
  let p₅: ℝ :=(65740070427486413*x₁*x₂)/178363791361120200 - (9504570889035697*x₁*x₄)/178363791361120200 - (17698009790880671*x₂*x₄)/178363791361120200 + (101367464809913963*x₂^2)/267545687041680300 - (162456639659393*x₃^2)/71345516544448080 + (6404306490634691*x₄^2)/133772843520840150
  let p₆: ℝ :=(176894083557425831*x₁*x₂)/16218794369586234080 + (259112901987750711*x₁*x₄)/81093971847931170400 - (720375276356657071*x₂*x₄)/243281915543793511200 + (1492139496863847229*x₃^2)/162187943695862340800 - (70505666363360349*x₄^2)/20273492961982792600
  let p₇: ℝ :=(3168003805714390517*x₁*x₂)/149213949686384722900 + (5645997643204784207*x₁*x₄)/149213949686384722900 - (3914891216760251669*x₂*x₄)/111910462264788542175 + (6361549171790574293*x₄^2)/37303487421596180725
  let p₈: ℝ :=(11297392950853061987*x₁*x₂)/218110257318533975760 - (4680939310411048411*x₁*x₄)/363517095530889959600 + (1368986907747475853*x₂*x₄)/109055128659266987880
  let p₉: ℝ :=(234241217078579069022133*x₁*x₄)/474490503935828603454000 + (38360209086417117452093*x₂*x₄)/94898100787165720690800
  let p₁₀: ℝ :=(35531237558787857799683057*x₂*x₄)/210817095370721162119919700
  let p₁₁: ℝ :=(21*x₃)/100 + (x₁*x₃)/16 - (23*x₂*x₃)/400 - (19*x₃*x₄)/400
  let p₁₂: ℝ :=(559*x₁*x₃)/33600 - (521*x₂*x₃)/33600 + (2999*x₃*x₄)/33600
  let p₁₃: ℝ :=(350887*x₁*x₃)/1199600 + (7475*x₂*x₃)/23992
  let p₁₄: ℝ :=(5036269*x₁*x₃)/149500000
  let p₀': ℝ :=x₁/100 - x₂/100 - x₄/200 + 3/50
  let p₁': ℝ :=(17*x₁)/600 + x₂/150 + (7*x₄)/1200
  let p₂': ℝ :=(91*x₂)/3400 - (49*x₄)/6800
  let p₃': ℝ :=(379*x₄)/10400
  let p₄': ℝ :=x₃/50
  let p0: ℝ :=x₁/200 - x₂/200 - x₄/200 + 1/10
  let p1: ℝ :=(279*x₁)/4000 + (81*x₂)/4000 + (41*x₄)/4000
  let p2: ℝ :=(99*x₂)/1550 - (41*x₄)/3100
  let p3: ℝ :=(2683*x₄)/19800
  let p4: ℝ :=x₃/20
  let ε: ℝ := 1/10000
  let σ₀₁: ℝ := 10000/10099*(p₀^2) +1009900/903701*(p₁^2) + 135555150/113834873*(p₂^2) +
            109281478080/48246560893*(p₃^2) +771944974288000/297272985601867*(p₄^2) +267545687041680300/101367464809913963*(p₅^2) +
            162187943695862340800/1492139496863847229*(p₆^2) + 37303487421596180725/6361549171790574293*(p₇^2) +
            218110257318533975760/11297392950853061987*(p₈^2) + 474490503935828603454000/234241217078579069022133*(p₉^2) +
            210817095370721162119919700/35531237558787857799683057*(p₁₀^2) +
            100/21*(p₁₁^2) + 33600/2999*(p₁₂^2) + 23992/7475*(p₁₃^2) + 149500000/5036269*(p₁₄^2)
  let σ₁₁: ℝ :=50/3*(p₀'^2) + 600/17*(p₁'^2) +  3400/91*(p₂'^2) +10400/379*(p₃'^2) +50*(p₄'^2)
  let σ₁₂: ℝ := 10*(p0^2) + 4000/279*(p1^2) + 1550/99*(p2^2) + 19800/2683*(p3^2) +  20*(p4^2)
  have h1 :10000/10099*(p₀^2) +1009900/903701*(p₁^2) + 135555150/113834873*(p₂^2) +
            109281478080/48246560893*(p₃^2) +771944974288000/297272985601867*(p₄^2) +267545687041680300/101367464809913963*(p₅^2) +
            162187943695862340800/1492139496863847229*(p₆^2) + 37303487421596180725/6361549171790574293*(p₇^2) +
            218110257318533975760/11297392950853061987*(p₈^2) + 474490503935828603454000/234241217078579069022133*(p₉^2) +
            210817095370721162119919700/35531237558787857799683057*(p₁₀^2) +
            100/21*(p₁₁^2) + 33600/2999*(p₁₂^2) + 23992/7475*(p₁₃^2) + 149500000/5036269*(p₁₄^2)= σ₀₁ := by exact rfl
  have h2 : 50/3*(p₀'^2) + 600/17*(p₁'^2) +  3400/91*(p₂'^2) +10400/379*(p₃'^2) +50*(p₄'^2)= σ₁₁ := by exact rfl
  have h3 : 10*(p0^2) + 4000/279*(p1^2) + 1550/99*(p2^2) + 19800/2683*(p3^2) +  20*(p4^2) = σ₁₂ := by exact rfl
  have D₁: I = σ₀₁ + σ₁₁*f₁ + σ₁₂*f₂ + ε := by
    rw [h₁,h₂,h₃]
    linear_combination
  have l₀: σ₀₁ ≥ 0 := by
    rw [← h1]
    have : p₀ ^ 2 ≥ 0 := by
          exact sq_nonneg p₀
    have : p₁ ^ 2 ≥ 0 := by
          exact sq_nonneg p₁
    have : p₂ ^ 2 ≥ 0 := by
          exact sq_nonneg p₂
    have : p₃ ^ 2 ≥ 0 := by
          exact sq_nonneg p₃
    have : p₄ ^ 2 ≥ 0 := by
          exact sq_nonneg p₄
    have : p₅ ^ 2 ≥ 0 := by
          exact sq_nonneg p₅
    have : p₆ ^ 2 ≥ 0 := by
          exact sq_nonneg p₆
    have : p₇ ^ 2 ≥ 0 := by
          exact sq_nonneg p₇
    have : p₈ ^ 2 ≥ 0 := by
          exact sq_nonneg p₈
    have : p₉ ^ 2 ≥ 0 := by
          exact sq_nonneg p₉
    have : p₁₀ ^ 2 ≥ 0 := by
          exact sq_nonneg p₁₀
    have : p₁₁ ^ 2 ≥ 0 := by
          exact sq_nonneg p₁₁
    have : p₁₂ ^ 2 ≥ 0 := by
          exact sq_nonneg p₁₂
    have : p₁₃ ^ 2 ≥ 0 := by
          exact sq_nonneg p₁₃
    have : p₁₄ ^ 2 ≥ 0 := by
          exact sq_nonneg p₁₄
    linarith
  have l₁: σ₁₁ ≥ 0 := by
    rw [← h2]
    have : p₀' ^ 2 ≥ 0 := by
      exact sq_nonneg p₀'
    have : p₁' ^ 2 ≥ 0 := by
      exact sq_nonneg p₁'
    have : p₂' ^ 2 ≥ 0 := by
      exact sq_nonneg p₂'
    have : p₃' ^ 2 ≥ 0 := by
      exact sq_nonneg p₃'
    have : p₄' ^ 2 ≥ 0 := by
      exact sq_nonneg p₄'
    linarith
  have l₂: σ₁₂ ≥ 0 := by
    rw [← h3]
    have : p0 ^ 2 ≥ 0 := by
        exact sq_nonneg p0
    have : p1 ^ 2  ≥ 0 := by
        exact sq_nonneg p1
    have : p2 ^ 2  ≥ 0 := by
        exact sq_nonneg p2
    have : p3 ^ 2 ≥ 0 := by
        exact sq_nonneg p3
    have : p4 ^ 2 ≥ 0 := by
        exact sq_nonneg p4
    linarith
  rw [D₁]
  intro f
  have h5 : ε >  0 := by norm_num
  have s₁ : 0 ≤ σ₁₁*f₁ := by
    exact Right.mul_nonneg l₁ f.left
  have s₂ : 0 ≤ σ₁₂*f₂  := by
    exact Right.mul_nonneg l₂ f.right
  linarith
