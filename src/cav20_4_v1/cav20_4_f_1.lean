import Mathlib.Tactic


theorem cav20_4_1 (x₁ x₂ x₃ x₄: ℝ)
             (h₁ : f₁=16-16*(x₁+x₂)^2-(x₁-x₂+4)^2-x₃^2)
             (h₂ : f₂=x₂-x₁-x₄^2-(1-x₄)^2)
             (h₃ : I= x₁/51 + (4*x₂)/51 - (35* x₁*x₂)/17 - (2* x₁^2)/51 - x₂^2/51 + 46/51):
              0 ≤ f₁ ∧ 0 ≤ f₂
                →  I > 0 := by

  let p₀: ℝ :=(4057*x₁)/13260 - (907*x₂)/3315 - (7*x₄)/60 + (3073*x₁*x₂)/44200 - (71*x₁*x₄)/7800 - (49*x₂*x₄)/3900 + (263*x₁^2)/1989 + (25373*x₂^2)/198900 - (283*x₃^2)/5850 - x₄^2/30 + 510949/510000
  let p₁: ℝ :=(55408887952*x₁)/66058041465 - (243903086263*x₂)/880773886200 - (44468837*x₄)/1328467400 + (73554677093*x₁*x₂)/880773886200 - (4711524847*x₁*x₄)/51810228600 - (692523271*x₂*x₄)/6476278575 + (16303036972*x₁^2)/66058041465 + (33203966807*x₂^2)/330290207325 + (7417503827*x₃^2)/155430685800 + (146199757*x₄^2)/1328467400
  let p₂: ℝ :=(49343424587706071*x₂)/51862719123072000 + (85804288712213*x₄)/1329813310848000 - (83451261305489159*x₁*x₂)/293888741697408000 - (1093914221644459*x₁*x₄)/17287573041024000 - (9498205819417*x₂*x₄)/196449693648000 - (173762409382313*x₁^2)/1102082781365280 - (269680242912547*x₂^2)/770687259696000 - (2035671432461921*x₃^2)/51862719123072000 - (4539198889181*x₄^2)/40297373056000
  let p₃: ℝ :=(220747253717710067*x₄)/493434245877060710 - (185473869340949279511*x₁*x₂)/1090489683388304169100 + (2295777473527099123*x₁*x₄)/25658580785607156920 - (10069062756490119229*x₂*x₄)/192439355892053676900 - (10233917650174787089*x₁^2)/150990879238380577260 - (1315472895302343305647*x₂^2)/19628814300989475043800 - (91205911912306873*x₃^2)/57731806767616103070 - (1564357367035516031*x₄^2)/9868684917541214200
  let p₄: ℝ :=(88317080654439034989373*x₁*x₂)/248804229665231016515700 + (605477666860136173271*x₁*x₄)/19514057228645569922800 - (1739106186376939424617*x₂*x₄)/131719886293357596978900 + (213146362664898359042705*x₁^2)/537417136076898995673912 - (604746246348059507543213*x₂^2)/26870856803844949783695600 - (2869923013647274954439*x₃^2)/790319317760145581873400 + (5527435418023538113457*x₄^2)/175626515057810129305200
  let p₅: ℝ :=(119918225833720134921612737241*x₁*x₂)/360217352903678226782171450000 - (104212763890969937223134341801*x₁*x₄)/1080652058711034680346514350000 - (154234145124310439460849684521*x₂*x₄)/1080652058711034680346514350000 + (31948756888148025527352563597*x₂^2)/90054338225919556695542862500 - (1321785177979445803487505899*x₃^2)/360217352903678226782171450000 + (63522476827715174154812391*x₄^2)/2131463626648983590427050000
  let p₆: ℝ :=(589062473101609249225695628569*x₁*x₂)/174877406124599718676035084952000 + (301910869752198936621181033553*x₁*x₄)/174877406124599718676035084952000 - (28861697898676898858444822863*x₂*x₄)/13452108163430747590464237304000 + (4531515889011195339705110969263*x₃^2)/524632218373799156028105254856000 - (5250492737608959516759551911733*x₄^2)/1573896655121397468084315764568000
  let p₇: ℝ :=(2531057428655256249542792895446353*x₁*x₂)/167892663687864787336074361411194150 + (28303940286220698839637142040823043*x₁*x₄)/671570654751459149344297445644776600 - (21340679179118418915260458111036117*x₂*x₄)/671570654751459149344297445644776600 + (132461190237720173225500719321942917*x₄^2)/755516986595391543012334626350373675
  let p₈: ℝ :=(2655027151566449451702986083768709107*x₁*x₂)/39738357071316051967650215796582875100 - (11808304988333113246917699305277340957*x₁*x₄)/688798189236144900772603740474103168400 - (534071126678030135385897947193114329*x₂*x₄)/137759637847228980154520748094820633680
  let p₉: ℝ :=(202763303702628957830580122074271508906971*x₁*x₄)/538439506337675948805365577788294206899600 + (464061755147892852709413093117987468783541*x₂*x₄)/1615318519013027846416096733364882620698800
  let p₁₀: ℝ :=(520343535547738360614352461797743073749750567*x₂*x₄)/3558495979981138209926681142403464981317341050
  let p₁₁: ℝ :=(1121*x₃)/5850 + (413*x₁*x₃)/7800 - (101*x₂*x₃)/1950 - (79*x₃*x₄)/1950
  let p₁₂: ℝ :=(553*x₁*x₃)/49400 - (21563*x₂*x₃)/1457300 + (231427*x₃*x₄)/3278925
  let p₁₃: ℝ :=(6269507*x₁*x₃)/26448800 + (305268519*x₂*x₃)/1203420400
  let p₁₄: ℝ :=(104307170701*x₁*x₃)/3174792597600

  let p₀': ℝ :=x₁/130 - x₂/65 - x₄/130 + 4/65
  let p₁': ℝ :=(31*x₁)/1040 + x₂/520 + x₄/1040
  let p₂': ℝ :=(54*x₂)/2015 - (3*x₄)/310
  let p₃': ℝ :=(41*x₄)/1560
  let p₄': ℝ :=x₃/65

  let p0: ℝ :=1/10 - x₄/60 - x₂/60
  let p1: ℝ :=x₁/15 + x₂/60
  let p2: ℝ :=(43*x₂)/720 - (7*x₄)/360
  let p3: ℝ :=(641*x₄)/5160
  let p4: ℝ :=x₃/30

  let ε: ℝ := 1/10000
  let σ₀₁: ℝ := 510000/510949*(p₀^2) +
      66058041465/55408887952*(p₁^2) +
      51862719123072000/49343424587706071*(p₂^2) +
      493434245877060710/220747253717710067*(p₃^2) +
      537417136076898995673912/213146362664898359042705*(p₄^2) +
      90054338225919556695542862500/31948756888148025527352563597*(p₅^2) +
      524632218373799156028105254856000/4531515889011195339705110969263*(p₆^2) +
      755516986595391543012334626350373675/132461190237720173225500719321942917*(p₇^2) +
      39738357071316051967650215796582875100/2655027151566449451702986083768709107*(p₈^2) +
      538439506337675948805365577788294206899600/202763303702628957830580122074271508906971*(p₉^2) +
      3558495979981138209926681142403464981317341050/520343535547738360614352461797743073749750567*(p₁₀^2) +
      5850/1121*(p₁₁^2) +
      3278925/231427*(p₁₂^2) +
      1203420400/305268519*(p₁₃^2) +
      3174792597600/104307170701*(p₁₄^2)
  let σ₁₁: ℝ :=65/4*(p₀'^2) +
      1040/31*(p₁'^2) +
      2015/54*(p₂'^2) +
      1560/41*(p₃'^2) +
      65*(p₄'^2)
  let σ₁₂: ℝ :=10*(p0^2) +
      15*(p1^2) +
      720/43*(p2^2) +
      5160/641*(p3^2) +
      30*(p4^2)
  have h1 :510000/510949*(p₀^2) +66058041465/55408887952*(p₁^2) +
      51862719123072000/49343424587706071*(p₂^2) +
      493434245877060710/220747253717710067*(p₃^2) +
      537417136076898995673912/213146362664898359042705*(p₄^2) +
      90054338225919556695542862500/31948756888148025527352563597*(p₅^2) +
      524632218373799156028105254856000/4531515889011195339705110969263*(p₆^2) +
      755516986595391543012334626350373675/132461190237720173225500719321942917*(p₇^2) +
      39738357071316051967650215796582875100/2655027151566449451702986083768709107*(p₈^2) +
      538439506337675948805365577788294206899600/202763303702628957830580122074271508906971*(p₉^2) +
      3558495979981138209926681142403464981317341050/520343535547738360614352461797743073749750567*(p₁₀^2) +
      5850/1121*(p₁₁^2) +
      3278925/231427*(p₁₂^2) +
      1203420400/305268519*(p₁₃^2) +
      3174792597600/104307170701*(p₁₄^2)= σ₀₁ := by exact rfl
  have h2 : 65/4*(p₀'^2) +
      1040/31*(p₁'^2) +
      2015/54*(p₂'^2) +
      1560/41*(p₃'^2) +
      65*(p₄'^2)= σ₁₁ := by exact rfl
  have h3 :10*(p0^2) +
      15*(p1^2) +
      720/43*(p2^2) +
      5160/641*(p3^2) +
      30*(p4^2)= σ₁₂ := by exact rfl
  have D₁: I = σ₀₁ + σ₁₁*f₁ + σ₁₂*f₂ + ε := by
    rw [h₁, h₂, h₃]
    linear_combination
  have l₀: σ₀₁ ≥ 0 := by
    rw [← h1]
    have : p₀ ^ 2 ≥ 0 := by
          exact sq_nonneg p₀
    have : p₁ ^ 2 ≥ 0 := by
          exact sq_nonneg p₁
    have : p₂ ^ 2 ≥ 0 := by
          exact sq_nonneg p₂
    have : p₃ ^ 2 ≥ 0 := by
          exact sq_nonneg p₃
    have : p₄ ^ 2 ≥ 0 := by
          exact sq_nonneg p₄
    have : p₅ ^ 2 ≥ 0 := by
          exact sq_nonneg p₅
    have : p₆ ^ 2 ≥ 0 := by
          exact sq_nonneg p₆
    have : p₇ ^ 2 ≥ 0 := by
          exact sq_nonneg p₇
    have : p₈ ^ 2 ≥ 0 := by
          exact sq_nonneg p₈
    have : p₉ ^ 2 ≥ 0 := by
          exact sq_nonneg p₉
    have : p₁₀ ^ 2 ≥ 0 := by
          exact sq_nonneg p₁₀
    have : p₁₁ ^ 2 ≥ 0 := by
          exact sq_nonneg p₁₁
    have : p₁₂ ^ 2 ≥ 0 := by
          exact sq_nonneg p₁₂
    have : p₁₃ ^ 2 ≥ 0 := by
          exact sq_nonneg p₁₃
    have : p₁₄ ^ 2 ≥ 0 := by
          exact sq_nonneg p₁₄
    linarith
  have l₁: σ₁₁ ≥ 0 := by
    rw [← h2]
    have : p₀' ^ 2 ≥ 0 := by
      exact sq_nonneg p₀'
    have : p₁' ^ 2 ≥ 0 := by
      exact sq_nonneg p₁'
    have : p₂' ^ 2 ≥ 0 := by
      exact sq_nonneg p₂'
    have : p₃' ^ 2 ≥ 0 := by
      exact sq_nonneg p₃'
    have : p₄' ^ 2 ≥ 0 := by
      exact sq_nonneg p₄'
    linarith
  have l₂: σ₁₂ ≥ 0 := by
    rw [← h3]
    have : p0 ^ 2 ≥ 0 := by
        exact sq_nonneg p0
    have : p1 ^ 2  ≥ 0 := by
        exact sq_nonneg p1
    have : p2 ^ 2  ≥ 0 := by
        exact sq_nonneg p2
    have : p3 ^ 2 ≥ 0 := by
        exact sq_nonneg p3
    have : p4 ^ 2 ≥ 0 := by
        exact sq_nonneg p4
    linarith
  rw [D₁]
  intro f
  have h5 : ε >  0 := by norm_num
  have s₁ : 0 ≤ σ₁₁*f₁ := by
    exact Right.mul_nonneg l₁ f.left
  have s₂ : 0 ≤ σ₁₂*f₂  := by
    exact Right.mul_nonneg l₂ f.right
  linarith
