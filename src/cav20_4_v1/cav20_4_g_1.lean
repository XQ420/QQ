import Mathlib.Tactic

theorem cav20_4_3 (x₁ x₂ x₃ x₄: ℝ)
            (h₁ : g₁=16-(x₁+x₂-4)^2-16*(x₁-x₂)^2-x₃^2)
            (h₂ : g₂=x₁+x₂-x₄^2-(2-x₄)^2)
            (h₃ : I = x₁/51 + (4*x₂)/51 - (35* x₁*x₂)/17 - (2* x₁^2)/51 - x₂^2/51 + 46/51)
              :
              0 ≤ g₁ ∧ 0 ≤ g₂
              → I ≤ 0 := by

  let p₀: ℝ := (283*x₁^2)/1275 - (353*x₂)/765 - (2*x₄)/5 - (1919*x₁*x₂)/7650 - (31*x₁*x₄)/600 - (17*x₂*x₄)/300 - (661*x₁)/1530 + (3347*x₂^2)/15300 + (23*x₄^2)/300 + 178/255
  let p₁: ℝ := (7308847*x₁)/8170200 + (749861*x₂)/4085100 - (17581*x₄)/53400 + (4612007*x₁*x₂)/16340400 - (61999*x₁*x₄)/320400 + (247351*x₂*x₄)/961200 - (95441*x₁^2)/302600 - (361751*x₂^2)/2042550 - (571*x₄^2)/4272
  let p₂: ℝ := (189365456*x₂)/234927225 - (7139963*x₄)/26103025 + (2731879529*x₁*x₂)/12780041040 + (3472702163*x₁*x₄)/11276506800 - (87363641*x₂*x₄)/346969440 - (1291483061*x₁^2)/12780041040 - (66806879*x₂^2)/245770020 - (9710789*x₄^2)/104412100
  let p₃: ℝ := (8570653591*x₄)/14202409200 + (4068324971257*x₁*x₂)/6953499544320 + (1224116413*x₁*x₄)/97387948800 - (33156330481*x₂*x₄)/1363431283200 - (2951847269179*x₁^2)/11589165907200 - (763713193939*x₂^2)/2897291476800 - (8271849379*x₄^2)/18936545600
  let p₄: ℝ := (1793354940412989773*x₂*x₄)/14099205113796096000 - (81907436131502299*x₁*x₄)/335695359852288000 - (146720193962346785009*x₁*x₂)/359529730401800448000 + (48701555344535831371*x₁^2)/119843243467266816000 + (439335201083611619*x₂^2)/14980405433408352000 - (51789778107325339*x₄^2)/1762400639224512000
  let p₅: ℝ := (231585543428662794497927*x₁*x₄)/1402604793922631943484800 - (1554862564289223533278889*x₁*x₂)/4207814381767895830454400 - (2290043486269156140998111*x₂*x₄)/8415628763535791660908800 + (555135911517880597899671*x₂^2)/1402604793922631943484800 - (4542741353478708886973*x₄^2)/140260479392263194348480
  let p₆: ℝ := (359593050259011284792633911*x₄^2)/1498866961098277614329111700 - (220469957447369893184984071*x₁*x₄)/2664652375285826869918420800 - (2759155419014571103323657071*x₂*x₄)/23981871377572441829265787200 - (423030370424527962417214397*x₁*x₂)/17986403533179331371949340400
  let p₇: ℝ := (10685630653135875080949764284177*x₁*x₂)/139809777940703587527376064596800 - (5605992955416263515181753312513*x₁*x₄)/186413037254271450036501419462400 - (5318472451600864345824526276961*x₂*x₄)/186413037254271450036501419462400
  let p₈: ℝ := (344559631122156213192444366915951421*x₁*x₄)/1384857732646409410491089451229339200 - (20710931079434339918316388232879717*x₂*x₄)/125896157513309946408280859202667200
  let p₉: ℝ := (242011238146449019433013286179047636413*x₂*x₄)/2232746409671572261487039497615365208080
  let p₁₀: ℝ := x₃/18 - (x₁*x₃)/72 - (x₂*x₃)/72 - (x₃*x₄)/48
  let p₁₁: ℝ := (55*x₃*x₄)/1152 - (11*x₂*x₃)/576 - (11*x₁*x₃)/576
  let p₁₂: ℝ := (11*x₂*x₃)/360 - (x₁*x₃)/40
  let p₁₃: ℝ := (x₁*x₃)/99

  let p₀': ℝ :=1/18 - x₂/72 - x₄/48 - x₁/72
  let p₁': ℝ :=(55*x₄)/1152 - (11*x₂)/576 - (11*x₁)/576
  let p₂': ℝ :=(11*x₂)/360 - x₁/40
  let p₃': ℝ :=x₁/99

  let p0: ℝ :=x₄/10 + 2/5
  let p1: ℝ :=(11*x₄)/40 - x₂/20 - x₁/20
  let p2: ℝ :=x₂/11 - (13*x₁)/220
  let p3: ℝ :=(21*x₁)/400

  let δ₀₁: ℝ :=255/178*(p₀^2) +
    8170200/7308847*(p₁^2) +
    234927225/189365456*(p₂^2) +
    14202409200/8570653591*(p₃^2) +
    119843243467266816000/48701555344535831371*(p₄^2) +
    1402604793922631943484800/555135911517880597899671*(p₅^2) +
    1498866961098277614329111700/359593050259011284792633911*(p₆^2) +
    139809777940703587527376064596800/10685630653135875080949764284177*(p₇^2) +
    1384857732646409410491089451229339200/344559631122156213192444366915951421*(p₈^2) +
    2232746409671572261487039497615365208080/242011238146449019433013286179047636413*(p₉^2) +
    18*(p₁₀^2) +
    1152/55*(p₁₁^2) +
    360/11*(p₁₂^2) +
    99*(p₁₃^2)
  let δ₁₁: ℝ :=18*(p₀'^2) +
    1152/55*(p₁'^2) +
    360/11*(p₂'^2) +
    99*(p₃'^2)
  let δ₁₂: ℝ :=5/2*(p0^2) +
    40/11*(p1^2) +
    11*(p2^2) +
    400/21*(p3^2)
  have h1 :255/178*(p₀^2) +
    8170200/7308847*(p₁^2) +
    234927225/189365456*(p₂^2) +
    14202409200/8570653591*(p₃^2) +
    119843243467266816000/48701555344535831371*(p₄^2) +
    1402604793922631943484800/555135911517880597899671*(p₅^2) +
    1498866961098277614329111700/359593050259011284792633911*(p₆^2) +
    139809777940703587527376064596800/10685630653135875080949764284177*(p₇^2) +
    1384857732646409410491089451229339200/344559631122156213192444366915951421*(p₈^2) +
    2232746409671572261487039497615365208080/242011238146449019433013286179047636413*(p₉^2) +
    18*(p₁₀^2) +
    1152/55*(p₁₁^2) +
    360/11*(p₁₂^2) +
    99*(p₁₃^2)= δ₀₁ := by exact rfl
  have h2 :18*(p₀'^2) +
    1152/55*(p₁'^2) +
    360/11*(p₂'^2) +
    99*(p₃'^2)= δ₁₁ := by  exact rfl
  have h3 :5/2*(p0^2) +
    40/11*(p1^2) +
    11*(p2^2) +
    400/21*(p3^2) = δ₁₂ := by  exact rfl
  have D₁: I = -δ₀₁ - δ₁₁*g₁- δ₁₂*g₂ := by
    simp [h₁,h₂,h₃]
    linear_combination
  have l₀ : δ₀₁ ≥ 0 := by
    rw [← h1]
    have : p₀ ^ 2 ≥ 0 := by
      exact sq_nonneg p₀
    have : p₁ ^ 2 ≥ 0 := by
      exact sq_nonneg p₁
    have : p₂ ^ 2  ≥ 0 := by
      exact sq_nonneg p₂
    have : p₃ ^ 2  ≥ 0 := by
      exact sq_nonneg p₃
    have : p₄ ^ 2 ≥ 0 := by
      exact sq_nonneg p₄
    have : p₅ ^ 2 ≥ 0 := by
      exact sq_nonneg p₅
    have : p₆ ^ 2 ≥ 0 := by
      exact sq_nonneg p₆
    have : p₇ ^ 2 ≥ 0 := by
      exact sq_nonneg p₇
    have : p₈ ^ 2 ≥ 0 := by
      exact sq_nonneg p₈
    have : p₉ ^ 2 ≥ 0 := by
      exact sq_nonneg p₉
    have : p₁₀ ^ 2 ≥ 0 := by
      exact sq_nonneg p₁₀
    have : p₁₁ ^ 2 ≥ 0 := by
      exact sq_nonneg p₁₁
    have : p₁₂ ^ 2 ≥ 0 := by
      exact sq_nonneg p₁₂
    have : p₁₃ ^ 2 ≥ 0 := by
      exact sq_nonneg p₁₃
    linarith
  have l₁: 0 ≤ δ₁₁ := by
    rw [← h2]
    have : p₀' ^ 2 ≥ 0 := by
      exact sq_nonneg p₀'
    have : p₁' ^ 2 ≥ 0 := by
      exact sq_nonneg p₁'
    have : p₂' ^ 2 ≥ 0 := by
      exact sq_nonneg p₂'
    have : p₃' ^ 2 ≥ 0 := by
      exact sq_nonneg p₃'
    linarith
  have l₂: 0 ≤ δ₁₂ := by
    rw [← h3]
    have : p0 ^ 2 ≥ 0 := by
        exact sq_nonneg p0
    have : p1 ^ 2  ≥ 0 := by
        exact sq_nonneg p1
    have : p2 ^ 2  ≥ 0 := by
        exact sq_nonneg p2
    have : p3 ^ 2 ≥ 0 := by
        exact sq_nonneg p3
    linarith
  rw [D₁]
  intro g
  have s₁ : 0 ≤ δ₁₁*g₁ := by
    exact Right.mul_nonneg l₁ g.left
  have s₂ : 0 ≤ δ₁₂*g₂  := by
    exact Right.mul_nonneg l₂ g.right
  linarith
