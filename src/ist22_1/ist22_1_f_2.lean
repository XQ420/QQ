import Mathlib.Data.Real.Basic
import Mathlib.Tactic

theorem ist22_1_f_2 (x₁ x₂ : ℝ)
                    (h₁ : f₁ = (2.2-x₂)*(x₂-1.2))
                    (h₂ : f₂ = ((x₁-2.2)*(5-x₁)))
                    (h₃ : I = (7369*x₁)/865 - (2621*x₂)/173 - (35214*x₁^2*x₂^2)/865 - (2291*x₁*x₂)/865
                     - (15126*x₁*x₂^2)/865 + (4259*x₁^2*x₂)/173 + (25786*x₁*x₂^3)/865 + (17799*x₁^3*x₂)/865
                      - (3316*x₁^2)/865 - (11312*x₁^3)/865 + (30118*x₂^2)/865 - (792*x₁^4)/865 - (18863*x₂^3)/865 - (877*x₂^4)/865 - 3336/865) :
                    0 ≤ f₁ → 0 ≤ f₂ → 0 < I := by

  let p₀ : ℝ :=(3967997953*x₁*x₂)/227270100 - (7998310673*x₂)/113635050 - (33541253233*x₁)/227270100 + (12919420961*x₁^2)/681810300 + (3817679719*x₂^2)/340905150 + 5750361548299/22727010000
  let p₁ : ℝ :=(206342512196465457566873*x₂)/980163933088551419925 - (30647763471644432929957*x₁)/217814207353011426650 + (15145541413475902355207*x₁*x₂)/653442622059034279950 + (166395294080703933556741*x₁^2)/7841311464708411359400 - (12475125960099328482013*x₂^2)/156826229294168227188
  let p₂ : ℝ :=(3591736635823135233292661763496171*x₁)/140686450143425772563306950191900 - (874922391192382768205499733039873*x₁*x₂)/31263655587427949458512655598200 - (939362591822446831382815223314649*x₁^2)/562745800573703090253227800767600 + (5288510928757882898820354789140411*x₂^2)/281372900286851545126613900383800
  let p₃ : ℝ :=(2226199774760671780894558027570997434843043*x₁^2)/2938659639829875096422207645721424078033560 - (35791049088606151182904670274715277273423711*x₁*x₂)/9795532132766250321407358819071413593445200 + (50439095194610332132830435392037468023464057*x₂^2)/14693298199149375482111038228607120390167800
  let p₄ : ℝ :=(65080738282675603257591500943601640005157396619668969*x₁*x₂)/275119157010926631476678072030205469474547485939096800 - (14140931041923406903251922806896825133155364007241753*x₁^2)/91706385670308877158892690676735156491515828646365600
  let p₅ : ℝ :=(24735143178786607468592134895820343919788780694338948855667*x₁^2)/3060187427085002611016513002469470155338508009412102458936600

  let p₀' : ℝ := (1701*x₂)/151 - (3388*x₁)/151 + 4035/151
  let p₁' : ℝ := (17908471*x₂)/406190 - (30617581*x₁)/812380
  let p₂' : ℝ := (19937936869*x₁)/64900298904

  let p0 : ℝ := 14737/870 - (3727*x₂)/870 - (5003*x₁)/1740
  let p1 : ℝ := (147685939*x₂)/12821190 - (83369147*x₁)/12821190
  let p2 : ℝ := (359716248661*x₁)/513947067720


  let σ₀ : ℝ := 22727010000/5750361548299*p₀^2 +
    980163933088551419925/206342512196465457566873*p₁^2 +
    140686450143425772563306950191900/3591736635823135233292661763496171*p₂^2 +
    14693298199149375482111038228607120390167800/50439095194610332132830435392037468023464057*p₃^2 +
    275119157010926631476678072030205469474547485939096800/65080738282675603257591500943601640005157396619668969*p₄^2 +
    3060187427085002611016513002469470155338508009412102458936600/24735143178786607468592134895820343919788780694338948855667*p₅^2
  let σ₁ : ℝ := 151/4035*p₀'^2 +406190/17908471*p₁'^2 + 64900298904/19937936869*p₂'^2
  let σ₂ : ℝ := 870/14737*p0^2 + 12821190/147685939*p1^2 + 513947067720/359716248661*p2^2
  let ε : ℝ := 1/10000
  have h1 :22727010000/5750361548299*p₀^2 +
      980163933088551419925/206342512196465457566873*p₁^2 +
      140686450143425772563306950191900/3591736635823135233292661763496171*p₂^2 +
      14693298199149375482111038228607120390167800/50439095194610332132830435392037468023464057*p₃^2 +
      275119157010926631476678072030205469474547485939096800/65080738282675603257591500943601640005157396619668969*p₄^2 +
      3060187427085002611016513002469470155338508009412102458936600/24735143178786607468592134895820343919788780694338948855667*p₅^2= σ₀ := by exact rfl
  have h2 :  151/4035*p₀'^2 +406190/17908471*p₁'^2 + 64900298904/19937936869*p₂'^2 = σ₁ := by exact rfl
  have h3 :  870/14737*p0^2 + 12821190/147685939*p1^2 + 513947067720/359716248661*p2^2 = σ₂ := by exact rfl
  have I₁ : I = σ₀ + σ₁*f₁ + σ₂*f₂ + ε := by
    simp [h₁, h₂, h₃]
    linear_combination
  intro f1 f2
  have h1 : 0 ≤ σ₀ := by
    rw [← h1]
    have : 0 ≤ p₀^2 := by apply pow_two_nonneg
    have : 0 ≤ p₁^2 := by apply pow_two_nonneg
    have : 0 ≤ p₂^2 := by apply pow_two_nonneg
    have : 0 ≤ p₃^2 := by apply pow_two_nonneg
    have : 0 ≤ p₄^2 := by apply pow_two_nonneg
    have : 0 ≤ p₅^2 := by apply pow_two_nonneg
    linarith
  have h2 : 0 ≤ σ₁*f₁ := by
    have : 0 ≤ σ₁ := by
      rw [← h2]
      have : 0 ≤ p₀' ^ 2 := by apply pow_two_nonneg
      have : 0 ≤ p₁' ^ 2 := by apply pow_two_nonneg
      have : 0 ≤ p₂'^2 := by apply pow_two_nonneg
      linarith
    exact Right.mul_nonneg this f1
  have h3 : 0 ≤ σ₂*f₂ := by
    have : 0 ≤ σ₂ := by
      rw [← h3]
      have : 0 ≤ p0 ^ 2 := by apply pow_two_nonneg
      have : 0 ≤ p1 ^ 2 := by apply pow_two_nonneg
      have : 0 ≤ p2 ^ 2 := by apply pow_two_nonneg
      linarith
    exact Right.mul_nonneg this f2
  have h4 : 0 < ε := by norm_num
  linarith
